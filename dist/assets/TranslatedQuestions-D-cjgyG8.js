import{a as J,O as K,M as X,y as Y,A as Z,a3 as ee,r as m,j as e,R as se,b as te,B as ae,C as re,D as ne,E as ie,F as le,G as oe,H as F,I as de}from"./index-RqZR_ZIX.js";import{L as ce}from"./Loader-zrXzeUC1.js";const ge=({question:r,index:j})=>{var V,D;const d=J(),[v]=K(),[N]=X(),[w,{isLoading:C}]=Y(),[Q,{isLoading:y}]=Z(),[_]=ee(),[o,b]=m.useState([...r.locales]),[S,n]=m.useState(null),[L,T]=m.useState("idle"),[A,I]=m.useState(!1),[k,U]=m.useState(!1),[M,O]=m.useState([]),$=async s=>{try{n(s);const a=await v({questionId:r._id,language:s}).unwrap();a.responseObject&&b(l=>[...l,{...a.responseObject,language:s,isValid:!1}])}catch(a){console.error("Translation failed:",a)}finally{n(null)}},q=s=>{var a;if(s===((a=r.locales[0])==null?void 0:a.language)){alert("Cannot delete the base locale.");return}b(l=>l.filter(i=>i.language!==s))},R=(s,a,l,i)=>{b(t=>t==null?void 0:t.map(g=>{var p;return g.language===s?{...g,[a]:a==="wrong"&&i!==void 0?(p=g.wrong)==null?void 0:p.map((E,u)=>u===i?l:E):l}:g}))},G=async()=>{try{T("saving"),await N({...r,_id:r._id,locales:o}).unwrap(),T("saved"),setTimeout(()=>T("idle"),2e3)}catch(s){console.error("Failed to save question:",s),T("idle")}},B=async s=>{try{const a=await _({questionId:r._id,originalLanguage:"en",targetLanguage:s}).unwrap();if(a.responseObject&&!a.responseObject.isValid){const l=M.some(i=>i.lang===s);O(l?i=>i==null?void 0:i.map(t=>t.lang===s?{...t,suggestions:[...t.suggestions||[],...a.responseObject.suggestions||[]]}:t):i=>[...i,{lang:s,suggestions:a.responseObject.suggestions||[],isValid:!1}])}}catch(a){console.error("Failed to validate translation:",a)}},W=(s,a)=>{b(l=>l==null?void 0:l.map(i=>i.language===s?{...i,...a,isValid:!0}:i))};return e.jsxs("div",{className:"w-full border rounded-lg shadow-md p-4 mb-4 bg-white",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2 flex items-center justify-between",children:[e.jsxs("span",{children:["Question ",j+1,": ",(V=o[0])==null?void 0:V.question," (",(D=o[0])==null?void 0:D.question.length," symbols)"]}),e.jsxs("span",{className:"text-gray-500",children:["ID #",r._id," -"," ",r.createdAt.slice(0,19).replace(/T|-/g,s=>s==="T"?" ":"/")]})]}),e.jsxs("table",{className:"w-full border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200",children:[e.jsx("th",{className:"border border-gray-300 px-4 py-2",children:"Language"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2",children:"Question"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2",children:"Answers"}),e.jsx("th",{className:"border border-gray-300 px-4 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:o==null?void 0:o.map((s,a)=>{var l,i;return a===0||A?e.jsxs(se.Fragment,{children:[e.jsxs("tr",{className:a===0?"bg-gray-100":"hover:bg-gray-50",children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-bold",children:s.language.toUpperCase()}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:k?e.jsx("input",{type:"text",value:s.question,onChange:t=>R(s.language,"question",t.target.value),className:"w-full border rounded px-2 py-1"}):s.question}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:e.jsxs("ul",{children:[e.jsxs("li",{className:"text-green-600 font-bold",children:["✔",k?e.jsx("input",{type:"text",value:typeof s.correct=="string"?s.correct:s.correct.join(", "),onChange:t=>R(s.language,"correct",t.target.value),className:"w-full border rounded px-2 py-1"}):s.correct,typeof s.correct=="string"&&`(${s.correct.length} symbols)`]}),(l=s.wrong)==null?void 0:l.map((t,g)=>e.jsxs("li",{children:["✗"," ",k?e.jsx("input",{type:"text",value:t,onChange:p=>R(s.language,"wrong",p.target.value,g),className:"w-full border rounded px-2 py-1"}):t,"(",t.length," symbols)"]},g))]})}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2 flex flex-col space-y-2",children:[a!==0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>q(s.language),className:"px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600",children:"Remove"}),e.jsx("button",{onClick:()=>B(s.language),className:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Validate Translation"})]}),a===0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>w(r._id),className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600",disabled:C,children:C?"Confirming...":"Confirm"}),e.jsx("button",{onClick:()=>Q(r._id),className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600",disabled:y,children:y?"Rejecting...":"Reject"}),e.jsx("button",{onClick:()=>d(`/edit-question/${r._id}`),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Edit"}),e.jsx("button",{onClick:G,className:"px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-600",children:L==="saving"?"Saving...":L==="saved"?"✔ Saved":"Save"}),e.jsx("button",{onClick:()=>U(!k),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-700",children:k?"Done Editing":"Edit Locales"})]})]})]},s.language),(i=M.filter(t=>t.lang===s.language))==null?void 0:i.map(t=>{var g,p,E;return t.suggestions&&t.suggestions.length>0?e.jsxs("tr",{className:"bg-yellow-100",children:[e.jsxs("td",{className:"border border-gray-300 px-4 py-2 font-bold",children:["Suggestions (",t.lang.toUpperCase(),")"]}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:(g=t.suggestions)==null?void 0:g.map((u,c)=>{var x,h;return e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold",children:["Suggestion ",c+1,":"]}),e.jsx("div",{children:u.question}),(((x=t.suggestions)==null?void 0:x.length)??0)>1&&c<(((h=t.suggestions)==null?void 0:h.length)??0)-1&&e.jsx("hr",{className:"my-2 border-t border-gray-300"})]},c)})}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:(p=t.suggestions)==null?void 0:p.map((u,c)=>{var x,h,f;return e.jsxs("div",{children:[e.jsxs("div",{children:["Correct: ",u.correct]}),e.jsxs("div",{children:["Wrong: ",(x=u.wrong)==null?void 0:x.join(", ")]}),(((h=t.suggestions)==null?void 0:h.length)??0)>1&&c<(((f=t.suggestions)==null?void 0:f.length)??0)-1&&e.jsx("hr",{className:"my-2 border-t border-gray-300"})]},c)})}),e.jsx("td",{className:"border border-gray-300 px-4 py-2 flex flex-col space-y-2",children:(E=t.suggestions)==null?void 0:E.map((u,c)=>{var x,h;return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>W(t.lang,u),className:"mt-2 px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600",children:["Apply Suggestion ",c+1]},c),e.jsxs("button",{onClick:()=>O(f=>f==null?void 0:f.map(H=>{var P;return H.lang===t.lang?{...H,suggestions:(P=H.suggestions)==null?void 0:P.filter((ue,z)=>z!==c)}:H})),className:"mt-2 px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600",children:["Remove Suggestion ",c+1]}),(((x=t.suggestions)==null?void 0:x.length)??0)>1&&c<(((h=t.suggestions)==null?void 0:h.length)??0)-1&&e.jsx("hr",{className:"my-2 border-t border-gray-300"})]})})})]},`${t.lang}-suggestions`):null})]},s.language):null})})]}),o.length>1&&e.jsx("button",{onClick:()=>I(!A),className:"mt-2 text-blue-500 hover:underline",children:A?"Hide Locales":"Show Locales"}),e.jsxs("div",{className:"mt-4 flex space-x-2 items-center",children:[e.jsx("span",{className:"text-gray-700 me-2",children:"Question Locales:"}),["ru","uk","en","es","fr","de","it","pl","tr"].map(s=>e.jsx("button",{onClick:()=>$(s),disabled:S===s,className:`px-2 py-1 border rounded ${o.some(a=>a.language===s)?"bg-gray-400 text-black":"bg-white text-black hover:bg-gray-200"}`,children:S===s?"...":s.toUpperCase()},s))]})]})},me=()=>{const r=te(),{limit:j,page:d,difficulty:v,type:N,title:w,status:C,totalPages:Q}=ae(),{data:y,isLoading:_,error:o,refetch:b}=re({limit:j,page:d,difficulty:v,type:N,title:w,status:C}),S=m.useRef(!0);return m.useEffect(()=>{S.current||b(),S.current=!1},[j,d,v,N,w,b]),_?e.jsx(ce,{}):o?e.jsxs("p",{className:"text-red-500",children:["Error:"," ",o&&"data"in o?o.data.message:"An error occurred"]}):e.jsxs("div",{className:"flex flex-col items-center w-full h-[calc(100vh-3rem)] space-y-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-md shadow-md flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Difficulty"}),e.jsxs("select",{value:v,onChange:n=>r(ne(n.target.value)),className:"w-full p-2 border rounded-md",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"1",children:"1 (Easy)"}),e.jsx("option",{value:"2",children:"2"}),e.jsx("option",{value:"3",children:"3 (Medium)"}),e.jsx("option",{value:"4",children:"4"}),e.jsx("option",{value:"5",children:"5 (Hard)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Type"}),e.jsxs("select",{value:N,onChange:n=>r(ie(n.target.value)),className:"w-full p-2 border rounded-md",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"map",children:"Map"}),e.jsx("option",{value:"choice",children:"One Choice"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Question Title"}),e.jsx("input",{type:"text",value:w,onChange:n=>r(le(n.target.value)),className:"w-full p-2 border rounded-md",placeholder:"Enter question title..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium",children:"Status"}),e.jsxs("select",{value:C,onChange:n=>r(oe(n.target.value)),className:"w-full p-2 border rounded-md",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{value:"proof_reading",children:"Proof Reading"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"pending",children:"Pending"})]})]})]}),e.jsx("div",{className:"flex-grow overflow-auto px-4",children:y&&y.responseObject.questions.length>0?y.responseObject.questions.map((n,L)=>e.jsx(ge,{question:n,index:j*(d-1)+L},n._id)):e.jsx("p",{className:"text-center text-gray-500",children:"No questions available."})}),e.jsxs("div",{className:"flex justify-center items-center py-4 bg-white shadow-md border-t w-full",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-300 rounded disabled:opacity-50 hover:bg-gray-400 transition",onClick:()=>r(F(d>1?d-1:1)),disabled:d===1,children:"Previous"}),e.jsxs("span",{className:"px-6 py-2 text-lg font-semibold text-gray-700",children:["Page ",d," of ",Q||1]}),e.jsx("button",{className:"px-4 py-2 bg-gray-300 rounded disabled:opacity-50 hover:bg-gray-400 transition",onClick:()=>r(F(d<Q?d+1:1)),disabled:d>=Q,children:"Next"}),e.jsxs("div",{className:"flex items-center ml-6 space-x-2",children:[e.jsx("span",{className:"text-gray-700",children:"Items per page:"}),e.jsx("select",{value:j,onChange:n=>{r(de(+n.target.value)),r(F(1))},className:"px-2 py-1 bg-gray-300 rounded border border-gray-400 focus:outline-none",children:[1,5,10,20,50].map(n=>e.jsx("option",{value:n,children:n},n))})]})]})]})};export{me as default};
